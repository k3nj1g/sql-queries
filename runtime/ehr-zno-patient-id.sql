SELECT row_to_json( "patient_subselect".*) AS  "patient"
FROM (SELECT  "patient". "id" AS  "id",
              "patient". "resource_type" AS  "resource_type",
              "patient". "status" AS  "status",
              "patient". "ts" AS  "ts",
              "patient". "txid" AS  "txid",
             ( "patient".resource || jsonb_build_object('id', "patient".id,'resourceType', "patient".resource_type)) AS  "resource",
             (SELECT json_agg(row_to_json( "condition_subselect".*)) AS  "condition"
              FROM (SELECT  "condition". "id" AS  "id",
                            "condition". "resource_type" AS  "resource_type",
                            "condition". "status" AS  "status",
                            "condition". "ts" AS  "ts",
                            "condition". "txid" AS  "txid",
                           ( "condition".resource || jsonb_build_object('id', "condition".id,'resourceType', "condition".resource_type)) AS  "resource"
                    FROM (SELECT  "res". "agg" ->> 'id' AS  "id",
                                  "res". "agg" ->> 'txid' AS  "txid",
                                 cast( "res". "agg" ->> 'ts' AS  "timestamptz") AS  "ts",
                                  "res". "agg" ->> 'resource_type' AS  "resource_type",
                                  "res". "agg" ->> 'status' AS  "status",
                                  "res". "agg" -> 'resource' AS  "resource",
                                 cast( "res". "agg" ->> 'cts' AS  "timestamptz") AS  "cts"
                          FROM ( WITH  "grouped"
                          AS
                          (SELECT jsonb_agg(row_to_json( "cond".*)) AS  "agg"
                          FROM  "condition"  "cond"
                          WHERE (( "cond". "resource" @@ logic_revinclude( "patient". "resource", "patient". "id",'subject') AND ( SELECT mkb FROM unnest(knife_extract_text(cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]')) mkb WHERE mkb SIMILAR TO 'F%' OR mkb SIMILAR TO 'F1%' OR mkb SIMILAR TO '(B2[0-4])%' OR mkb SIMILAR TO '(A5[0-469]|A6[03]|Z22.[48]|Z11.3|Z71.2|Z86.1|Z20.2|N89|N34.1|B37.3|B37.4)%' OR mkb SIMILAR TO '(A1[5-9]|B90|R76.1|Z20.1)%' 
                          LIMIT 1 ) IS NULL  AND ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'Z03.1' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'C00' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'C97') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'C97%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D00' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D09') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D09%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'B18.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'B18.1' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D10' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D11') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D11%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D12.6' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D13.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D13.4' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D13.7' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D14.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D14.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D14.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D14.3' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D16' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D16') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D16%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D22' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D24') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D24%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D29.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D30.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D30.3' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D30.4' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D31' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D31') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D31%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D35.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D35.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D35.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D35.8' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D37.6' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D39.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D41.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D44.8' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D81' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D84') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D84%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E05.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E06.3' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E22.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E28.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E34.5' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E34.8' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'J31' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'J31') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'J31%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'J33' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'J33') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'J33%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'J37.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'J37.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'J38.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K13.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K13.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K13.7' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K22.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K22.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K22.7' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K29.4' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K29.5' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K31.7' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'K50' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'K50') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'K50%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K51.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K51.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K51.3' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K51.4' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K51.5' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K51.8' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K51.9' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K74.3' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K74.4' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K74.5' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K74.6' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'L57' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'L57') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'L57%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'L82' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'L82') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'L82%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'M85' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'M85') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'M85%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'M88' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'M88') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'M88%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'M96' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'M96') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'M96%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'N48.0' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'N60' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'N60') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'N60%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'N84' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'N84') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'N84%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'N85.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'N85.1' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'N87' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'N87') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'N87%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'N88.0' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'Q50' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'Q50') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'Q50%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'Q56' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'Q56') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'Q56%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'Q78.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'Q82.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'Q82.5' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'Q85.1' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'Q96' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'Q99') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'Q99%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'B18.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'B18.1' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D00' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D11') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D11%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D12.6' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D13.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D13.4' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D13.7' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D14' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D14') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D14%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D16' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D16') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D16%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D22' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D24') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D24%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D29.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D30.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D30.3' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D30.4' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D31' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D31') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D31%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D35.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D35.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D35.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D35.8' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D37.6' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D39.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D41.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'D44.8' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'D81' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'D84') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'D84%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E05.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E06.3' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E22.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E28.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E34.5' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'E34.8' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'J31' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'J31') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'J31%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'J33' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'J33') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'J33%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'J37.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'J37.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'J38.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K13.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K13.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K13.7' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K22.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K22.2' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K22.7' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K29.4' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K29.5' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K31.7' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'K50' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'K51') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'K51%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K74.3' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K74.4' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K74.5' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'K74.6' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'L57' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'L57') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'L57%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'L82' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'L82') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'L82%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'M85' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'M85') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'M85%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'M88' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'M88') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'M88%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'M96' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'M96') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'M96%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'N48.0' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'N60' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'N60') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'N60%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'N84' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'N84') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'N84%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'N85.0' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'N85.1' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'N87' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'N87') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'N87%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'N88.0' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'Q50' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'Q50') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'Q50%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'Q56' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'Q56') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'Q56%')) OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'Q78.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'Q82.1' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'Q82.5' OR (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] = 'Q85.1' OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'Q96' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'Q99') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'Q99%')) OR (((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] >= 'C00' AND (knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] <= 'C97') OR ((knife_extract_text (cond.resource,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'))[1] LIKE 'C97%')))) AND lower( "patient". "resource" #>> '{name,0,given,0}') = CASE WHEN  "cond". "resource" #>> '{subject,identifier,value}' = '0000000000000000' THEN lower(split_part(split_part( "cond". "resource" #>> '{subject,display}',',',1),' ',2)) ELSE lower( "patient". "resource" #>> '{name,0,given,0}') END AND coalesce(lower( "patient". "resource" #>> '{name,0,given,1}'),'') = CASE WHEN  "cond". "resource" #>> '{subject,identifier,value}' = '0000000000000000' THEN lower(split_part(split_part( "cond". "resource" #>> '{subject,display}',',',1),' ',3)) ELSE coalesce(lower( "patient". "resource" #>> '{name,0,given,1}'),'') END AND cast( "patient". "resource" ->> 'birthDate' AS  "date") = CASE WHEN  "cond". "resource" #>> '{subject,identifier,value}' = '0000000000000000' THEN to_date(split_part( "cond". "resource" #>> '{subject,display}',',',2),'DD.mm.YYYY') ELSE cast( "patient". "resource" ->> 'birthDate' AS  "date") END)
                          GROUP BY knife_extract_text(cond.resource::jsonb,'[["code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'::jsonb))
                          SELECT (SELECT  "grouped_agg"
                                  FROM jsonb_array_elements( "grouped". "agg")  "grouped_agg"
                                  ORDER BY  "grouped_agg" #>> '{resource,recordedDate}' DESC NULLS last LIMIT 1)
                          AS  "agg"
                          FROM  "grouped")  "res")  "condition"
                    ORDER BY condition.resource #>> '{recordedDate}' DESC NULLS last LIMIT 6)  "condition_subselect") AS  "condition",
             (SELECT json_agg(row_to_json( "medrecordzno_subselect".*)) AS  "medrecordzno"
              FROM (SELECT  "medrecordzno". "id" AS  "id",
                            "medrecordzno". "resource_type" AS  "resource_type",
                            "medrecordzno". "status" AS  "status",
                            "medrecordzno". "ts" AS  "ts",
                            "medrecordzno". "txid" AS  "txid",
                           ( "medrecordzno".resource || jsonb_build_object('id', "medrecordzno".id,'resourceType', "medrecordzno".resource_type)) AS  "resource"
                    FROM (SELECT logic_revinclude( "encounter". "resource", "encounter". "id",'encounter.#') AS  "js_q"
                          FROM  "encounter"  "encounter"
                          WHERE ( "encounter". "resource" @@ logic_revinclude( "patient". "resource", "patient". "id",'subject') AND ( SELECT mkb FROM unnest(knife_extract_text(encounter.resource,'[["contained",{},"code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]')) mkb WHERE mkb SIMILAR TO 'F%' OR mkb SIMILAR TO 'F1%' OR mkb SIMILAR TO '(B2[0-4])%' OR mkb SIMILAR TO '(A5[0-469]|A6[03]|Z22.[48]|Z11.3|Z71.2|Z86.1|Z20.2|N89|N34.1|B37.3|B37.4)%' OR mkb SIMILAR TO '(A1[5-9]|B90|R76.1|Z20.1)%' 
                          LIMIT 1 ) IS NULL  AND ( "encounter". "resource" @@ 'serviceType.coding.#((system = "urn:CodeSystem:oms.v002-care-profile" and (code = "18" or code = "60")) or (system = "urn:CodeSystem:health-care-profile" and ((code = "14" and display = "Онкология") or (code = "51" and display = "Онкология детская"))))'::jsquery OR (SELECT  "enc_code"
                          FROM unnest(knife_extract_text (encounter.resource::jsonb,'[["contained",{},"code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'::jsonb))  "enc_code"
                          WHERE ( "enc_code" = 'Z03.1' OR (( "enc_code" >= 'C00' AND  "enc_code" < 'C97') OR ( "enc_code" LIKE 'C97%')) OR (( "enc_code" >= 'D00' AND  "enc_code" < 'D09') OR ( "enc_code" LIKE 'D09%')) OR  "enc_code" = 'B18.0' OR  "enc_code" = 'B18.1' OR (( "enc_code" >= 'D10' AND  "enc_code" < 'D11') OR ( "enc_code" LIKE 'D11%')) OR  "enc_code" = 'D12.6' OR  "enc_code" = 'D13.1' OR  "enc_code" = 'D13.4' OR  "enc_code" = 'D13.7' OR  "enc_code" = 'D14.0' OR  "enc_code" = 'D14.1' OR  "enc_code" = 'D14.2' OR  "enc_code" = 'D14.3' OR (( "enc_code" >= 'D16' AND  "enc_code" < 'D16') OR ( "enc_code" LIKE 'D16%')) OR (( "enc_code" >= 'D22' AND  "enc_code" < 'D24') OR ( "enc_code" LIKE 'D24%')) OR  "enc_code" = 'D29.1' OR  "enc_code" = 'D30.0' OR  "enc_code" = 'D30.3' OR  "enc_code" = 'D30.4' OR (( "enc_code" >= 'D31' AND  "enc_code" < 'D31') OR ( "enc_code" LIKE 'D31%')) OR  "enc_code" = 'D35.0' OR  "enc_code" = 'D35.1' OR  "enc_code" = 'D35.2' OR  "enc_code" = 'D35.8' OR  "enc_code" = 'D37.6' OR  "enc_code" = 'D39.1' OR  "enc_code" = 'D41.0' OR  "enc_code" = 'D44.8' OR (( "enc_code" >= 'D81' AND  "enc_code" < 'D84') OR ( "enc_code" LIKE 'D84%')) OR  "enc_code" = 'E05.0' OR  "enc_code" = 'E06.3' OR  "enc_code" = 'E22.0' OR  "enc_code" = 'E28.2' OR  "enc_code" = 'E34.5' OR  "enc_code" = 'E34.8' OR (( "enc_code" >= 'J31' AND  "enc_code" < 'J31') OR ( "enc_code" LIKE 'J31%')) OR (( "enc_code" >= 'J33' AND  "enc_code" < 'J33') OR ( "enc_code" LIKE 'J33%')) OR  "enc_code" = 'J37.0' OR  "enc_code" = 'J37.1' OR  "enc_code" = 'J38.1' OR  "enc_code" = 'K13.0' OR  "enc_code" = 'K13.2' OR  "enc_code" = 'K13.7' OR  "enc_code" = 'K22.0' OR  "enc_code" = 'K22.2' OR  "enc_code" = 'K22.7' OR  "enc_code" = 'K29.4' OR  "enc_code" = 'K29.5' OR  "enc_code" = 'K31.7' OR (( "enc_code" >= 'K50' AND  "enc_code" < 'K50') OR ( "enc_code" LIKE 'K50%')) OR  "enc_code" = 'K51.0' OR  "enc_code" = 'K51.2' OR  "enc_code" = 'K51.3' OR  "enc_code" = 'K51.4' OR  "enc_code" = 'K51.5' OR  "enc_code" = 'K51.8' OR  "enc_code" = 'K51.9' OR  "enc_code" = 'K74.3' OR  "enc_code" = 'K74.4' OR  "enc_code" = 'K74.5' OR  "enc_code" = 'K74.6' OR (( "enc_code" >= 'L57' AND  "enc_code" < 'L57') OR ( "enc_code" LIKE 'L57%')) OR (( "enc_code" >= 'L82' AND  "enc_code" < 'L82') OR ( "enc_code" LIKE 'L82%')) OR (( "enc_code" >= 'M85' AND  "enc_code" < 'M85') OR ( "enc_code" LIKE 'M85%')) OR (( "enc_code" >= 'M88' AND  "enc_code" < 'M88') OR ( "enc_code" LIKE 'M88%')) OR (( "enc_code" >= 'M96' AND  "enc_code" < 'M96') OR ( "enc_code" LIKE 'M96%')) OR  "enc_code" = 'N48.0' OR (( "enc_code" >= 'N60' AND  "enc_code" < 'N60') OR ( "enc_code" LIKE 'N60%')) OR (( "enc_code" >= 'N84' AND  "enc_code" < 'N84') OR ( "enc_code" LIKE 'N84%')) OR  "enc_code" = 'N85.0' OR  "enc_code" = 'N85.1' OR (( "enc_code" >= 'N87' AND  "enc_code" < 'N87') OR ( "enc_code" LIKE 'N87%')) OR  "enc_code" = 'N88.0' OR (( "enc_code" >= 'Q50' AND  "enc_code" < 'Q50') OR ( "enc_code" LIKE 'Q50%')) OR (( "enc_code" >= 'Q56' AND  "enc_code" < 'Q56') OR ( "enc_code" LIKE 'Q56%')) OR  "enc_code" = 'Q78.1' OR  "enc_code" = 'Q82.1' OR  "enc_code" = 'Q82.5' OR  "enc_code" = 'Q85.1' OR (( "enc_code" >= 'Q96' AND  "enc_code" < 'Q99') OR ( "enc_code" LIKE 'Q99%')) OR  "enc_code" = 'B18.0' OR  "enc_code" = 'B18.1' OR (( "enc_code" >= 'D00' AND  "enc_code" < 'D11') OR ( "enc_code" LIKE 'D11%')) OR  "enc_code" = 'D12.6' OR  "enc_code" = 'D13.1' OR  "enc_code" = 'D13.4' OR  "enc_code" = 'D13.7' OR (( "enc_code" >= 'D14' AND  "enc_code" < 'D14') OR ( "enc_code" LIKE 'D14%')) OR (( "enc_code" >= 'D16' AND  "enc_code" < 'D16') OR ( "enc_code" LIKE 'D16%')) OR (( "enc_code" >= 'D22' AND  "enc_code" < 'D24') OR ( "enc_code" LIKE 'D24%')) OR  "enc_code" = 'D29.1' OR  "enc_code" = 'D30.0' OR  "enc_code" = 'D30.3' OR  "enc_code" = 'D30.4' OR (( "enc_code" >= 'D31' AND  "enc_code" < 'D31') OR ( "enc_code" LIKE 'D31%')) OR  "enc_code" = 'D35.0' OR  "enc_code" = 'D35.1' OR  "enc_code" = 'D35.2' OR  "enc_code" = 'D35.8' OR  "enc_code" = 'D37.6' OR  "enc_code" = 'D39.1' OR  "enc_code" = 'D41.0' OR  "enc_code" = 'D44.8' OR (( "enc_code" >= 'D81' AND  "enc_code" < 'D84') OR ( "enc_code" LIKE 'D84%')) OR  "enc_code" = 'E05.0' OR  "enc_code" = 'E06.3' OR  "enc_code" = 'E22.0' OR  "enc_code" = 'E28.2' OR  "enc_code" = 'E34.5' OR  "enc_code" = 'E34.8' OR (( "enc_code" >= 'J31' AND  "enc_code" < 'J31') OR ( "enc_code" LIKE 'J31%')) OR (( "enc_code" >= 'J33' AND  "enc_code" < 'J33') OR ( "enc_code" LIKE 'J33%')) OR  "enc_code" = 'J37.0' OR  "enc_code" = 'J37.1' OR  "enc_code" = 'J38.1' OR  "enc_code" = 'K13.0' OR  "enc_code" = 'K13.2' OR  "enc_code" = 'K13.7' OR  "enc_code" = 'K22.0' OR  "enc_code" = 'K22.2' OR  "enc_code" = 'K22.7' OR  "enc_code" = 'K29.4' OR  "enc_code" = 'K29.5' OR  "enc_code" = 'K31.7' OR (( "enc_code" >= 'K50' AND  "enc_code" < 'K51') OR ( "enc_code" LIKE 'K51%')) OR  "enc_code" = 'K74.3' OR  "enc_code" = 'K74.4' OR  "enc_code" = 'K74.5' OR  "enc_code" = 'K74.6' OR (( "enc_code" >= 'L57' AND  "enc_code" < 'L57') OR ( "enc_code" LIKE 'L57%')) OR (( "enc_code" >= 'L82' AND  "enc_code" < 'L82') OR ( "enc_code" LIKE 'L82%')) OR (( "enc_code" >= 'M85' AND  "enc_code" < 'M85') OR ( "enc_code" LIKE 'M85%')) OR (( "enc_code" >= 'M88' AND  "enc_code" < 'M88') OR ( "enc_code" LIKE 'M88%')) OR (( "enc_code" >= 'M96' AND  "enc_code" < 'M96') OR ( "enc_code" LIKE 'M96%')) OR  "enc_code" = 'N48.0' OR (( "enc_code" >= 'N60' AND  "enc_code" < 'N60') OR ( "enc_code" LIKE 'N60%')) OR (( "enc_code" >= 'N84' AND  "enc_code" < 'N84') OR ( "enc_code" LIKE 'N84%')) OR  "enc_code" = 'N85.0' OR  "enc_code" = 'N85.1' OR (( "enc_code" >= 'N87' AND  "enc_code" < 'N87') OR ( "enc_code" LIKE 'N87%')) OR  "enc_code" = 'N88.0' OR (( "enc_code" >= 'Q50' AND  "enc_code" < 'Q50') OR ( "enc_code" LIKE 'Q50%')) OR (( "enc_code" >= 'Q56' AND  "enc_code" < 'Q56') OR ( "enc_code" LIKE 'Q56%')) OR  "enc_code" = 'Q78.1' OR  "enc_code" = 'Q82.1' OR  "enc_code" = 'Q82.5' OR  "enc_code" = 'Q85.1' OR (( "enc_code" >= 'Q96' AND  "enc_code" < 'Q99') OR ( "enc_code" LIKE 'Q99%')) OR (( "enc_code" >= 'C00' AND  "enc_code" < 'C97') OR ( "enc_code" LIKE 'C97%')))
                          LIMIT 1) IS NOT NULL)))  "enc"
                      INNER JOIN  "medrecordzno"  "medrecordzno" ON  "medrecordzno". "resource" @@  "enc". "js_q"
                    ORDER BY cast( "medrecordzno". "resource" ->> 'date' AS  "timestamptz") DESC NULLS last LIMIT 6)  "medrecordzno_subselect") AS  "med_record_zno",
             (SELECT json_agg(row_to_json( "servicerequest_subselect".*)) AS  "servicerequest"
              FROM (SELECT  "servicerequest". "id" AS  "id",
                            "servicerequest". "resource_type" AS  "resource_type",
                            "servicerequest". "status" AS  "status",
                            "servicerequest". "ts" AS  "ts",
                            "servicerequest". "txid" AS  "txid",
                           ( "servicerequest".resource || jsonb_build_object('id', "servicerequest".id,'resourceType', "servicerequest".resource_type)) AS  "resource",
                           (SELECT row_to_json( "diagnosticreport_subselect".*) AS  "diagnosticreport"
                            FROM (SELECT  "diagnosticreport". "id" AS  "id",
                                          "diagnosticreport". "resource_type" AS  "resource_type",
                                          "diagnosticreport". "status" AS  "status",
                                          "diagnosticreport". "ts" AS  "ts",
                                          "diagnosticreport". "txid" AS  "txid",
                                         ( "diagnosticreport".resource || jsonb_build_object('id', "diagnosticreport".id,'resourceType', "diagnosticreport".resource_type)) AS  "resource"
                                  FROM  "diagnosticreport"
                                  WHERE  "diagnosticreport". "resource" @@ logic_revinclude( "servicerequest". "resource", "servicerequest". "id",'basedOn.#')
                                  ORDER BY  "ts" DESC LIMIT 1)  "diagnosticreport_subselect") AS  "diagnosticReport"
                    FROM  "servicerequest"
                    WHERE (( "servicerequest". "resource" @@ logic_revinclude( "patient". "resource", "patient". "id",'subject') AND  "servicerequest". "resource" @@ 'category.#.coding.#(system= "urn:CodeSystem:servicerequest-category" and code = "Referral-LMI")'::jsquery AND ( SELECT mkb FROM unnest(knife_extract_text(servicerequest.resource,'[["reasonCode","coding",{"system":"urn:CodeSystem:icd-10"},"code"],["reasonReference","identifier",{"system":"urn:CodeSystem:icd-10"},"value"]]')) mkb WHERE mkb SIMILAR TO 'F%' OR mkb SIMILAR TO 'F1%' OR mkb SIMILAR TO '(B2[0-4])%' OR mkb SIMILAR TO '(A5[0-469]|A6[03]|Z22.[48]|Z11.3|Z71.2|Z86.1|Z20.2|N89|N34.1|B37.3|B37.4)%' OR mkb SIMILAR TO '(A1[5-9]|B90|R76.1|Z20.1)%' 
                    LIMIT 1 ) IS NULL  AND  "servicerequest". "resource" @@ 'category.#.coding.#(system = "urn:CodeSystem:lab-group" and (code = "501" or code = "13"))'::jsquery) AND lower( "patient". "resource" #>> '{name,0,given,0}') = CASE WHEN  "servicerequest". "resource" #>> '{subject,identifier,value}' = '0000000000000000' THEN lower(split_part(split_part( "servicerequest". "resource" #>> '{subject,display}',',',1),' ',2)) ELSE lower( "patient". "resource" #>> '{name,0,given,0}') END AND coalesce(lower( "patient". "resource" #>> '{name,0,given,1}'),'') = CASE WHEN  "servicerequest". "resource" #>> '{subject,identifier,value}' = '0000000000000000' THEN lower(split_part(split_part( "servicerequest". "resource" #>> '{subject,display}',',',1),' ',3)) ELSE coalesce(lower( "patient". "resource" #>> '{name,0,given,1}'),'') END AND cast( "patient". "resource" ->> 'birthDate' AS  "date") = CASE WHEN  "servicerequest". "resource" #>> '{subject,identifier,value}' = '0000000000000000' THEN to_date(split_part( "servicerequest". "resource" #>> '{subject,display}',',',2),'DD.mm.YYYY') ELSE cast( "patient". "resource" ->> 'birthDate' AS  "date") END)
                    ORDER BY cast( "servicerequest". "resource" ->> 'authoredOn' AS  "timestamptz") DESC NULLS first LIMIT 6)  "servicerequest_subselect") AS  "laboratory",
             (SELECT json_agg(row_to_json( "servicerequest_subselect".*)) AS  "servicerequest"
              FROM (SELECT  "servicerequest". "id" AS  "id",
                            "servicerequest". "resource_type" AS  "resource_type",
                            "servicerequest". "status" AS  "status",
                            "servicerequest". "ts" AS  "ts",
                            "servicerequest". "txid" AS  "txid",
                           ( "servicerequest".resource || jsonb_build_object('id', "servicerequest".id,'resourceType', "servicerequest".resource_type)) AS  "resource",
                           (SELECT row_to_json( "diagnosticreport_subselect".*) AS  "diagnosticreport"
                            FROM (SELECT  "diagnosticreport". "id" AS  "id",
                                          "diagnosticreport". "resource_type" AS  "resource_type",
                                          "diagnosticreport". "status" AS  "status",
                                          "diagnosticreport". "ts" AS  "ts",
                                          "diagnosticreport". "txid" AS  "txid",
                                         ( "diagnosticreport".resource || jsonb_build_object('id', "diagnosticreport".id,'resourceType', "diagnosticreport".resource_type)) AS  "resource"
                                  FROM  "diagnosticreport"
                                  WHERE "diagnosticreport". "resource" @@ logic_revinclude( "servicerequest". "resource", "servicerequest". "id",'basedOn.#')
                                  LIMIT 1)  "diagnosticreport_subselect") AS  "diagnosticReport"
                    FROM  "servicerequest"
                    WHERE (( SELECT mkb FROM unnest(knife_extract_text(servicerequest.resource,'[["reasonCode","coding",{"system":"urn:CodeSystem:icd-10"},"code"],["reasonReference","identifier",{"system":"urn:CodeSystem:icd-10"},"value"]]')) mkb WHERE mkb SIMILAR TO 'F%' OR mkb SIMILAR TO 'F1%' OR mkb SIMILAR TO '(B2[0-4])%' OR mkb SIMILAR TO '(A5[0-469]|A6[03]|Z22.[48]|Z11.3|Z71.2|Z86.1|Z20.2|N89|N34.1|B37.3|B37.4)%' OR mkb SIMILAR TO '(A1[5-9]|B90|R76.1|Z20.1)%' 
                    LIMIT 1 ) IS NULL  AND  "servicerequest". "resource" @@ logic_revinclude ( "patient". "resource", "patient". "id",'subject') AND  "servicerequest". "resource" @@ 'category.#.coding.#(system= "urn:CodeSystem:servicerequest-category" and code = "Referral-IMI")'::jsquery AND  "servicerequest". "resource" @@ 'code.coding.#(system = "urn:CodeSystem:diagnostic-group" and (code = "10" or code = "70"))'::jsquery)
                    ORDER BY cast( "servicerequest". "resource" ->> 'authoredOn' AS  "timestamptz") DESC NULLS first LIMIT 6)  "servicerequest_subselect") AS  "instrumental",
             (SELECT json_agg(row_to_json( "encounter_subselect".*)) AS  "encounter"
              FROM (SELECT  "encounter". "id" AS  "id",
                            "encounter". "resource_type" AS  "resource_type",
                            "encounter". "status" AS  "status",
                            "encounter". "ts" AS  "ts",
                            "encounter". "txid" AS  "txid",
                           ( "encounter".resource || jsonb_build_object('id', "encounter".id,'resourceType', "encounter".resource_type)) AS  "resource",
                           (SELECT json_agg(row_to_json( "documentreference_subselect".*)) AS  "documentreference"
                            FROM (SELECT  "documentreference". "id" AS  "id",
                                          "documentreference". "resource_type" AS  "resource_type",
                                          "documentreference". "status" AS  "status",
                                          "documentreference". "ts" AS  "ts",
                                          "documentreference". "txid" AS  "txid",
                                         ( "documentreference".resource || jsonb_build_object('id', "documentreference".id,'resourceType', "documentreference".resource_type)) AS  "resource"
                                  FROM  "documentreference"
                                  WHERE (( SELECT mkb FROM unnest(knife_extract_text(documentreference.resource,'[["extension",{"url":"urn:extension:diagnosis"},"extension",{"url":"mkb"},"valueCodeableConcept","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]')) mkb WHERE mkb SIMILAR TO 'F%' OR mkb SIMILAR TO 'F1%' OR mkb SIMILAR TO '(B2[0-4])%' OR mkb SIMILAR TO '(A5[0-469]|A6[03]|Z22.[48]|Z11.3|Z71.2|Z86.1|Z20.2|N89|N34.1|B37.3|B37.4)%' OR mkb SIMILAR TO '(A1[5-9]|B90|R76.1|Z20.1)%' 
                                  LIMIT 1 ) IS NULL  AND  "documentreference". "resource" @@ logic_revinclude ( "encounter". "resource", "encounter". "id",'context.encounter.#') AND coalesce(documentreference.resource ->> 'active','true') = 'true')
                                  ORDER BY cast( "documentreference". "resource" ->> 'date' AS  "timestamptz") DESC NULLS last LIMIT 6)  "documentreference_subselect") AS  "documentReference"
                    FROM  "encounter"
                    WHERE ( "encounter". "resource" @@ logic_revinclude( "patient". "resource", "patient". "id",'subject') AND ( SELECT mkb FROM unnest(knife_extract_text(encounter.resource,'[["contained",{},"code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]')) mkb WHERE mkb SIMILAR TO 'F%' OR mkb SIMILAR TO 'F1%' OR mkb SIMILAR TO '(B2[0-4])%' OR mkb SIMILAR TO '(A5[0-469]|A6[03]|Z22.[48]|Z11.3|Z71.2|Z86.1|Z20.2|N89|N34.1|B37.3|B37.4)%' OR mkb SIMILAR TO '(A1[5-9]|B90|R76.1|Z20.1)%' 
                    LIMIT 1 ) IS NULL  AND ( "encounter". "resource" @@ 'serviceType.coding.#((system = "urn:CodeSystem:oms.v002-care-profile" and (code = "18" or code = "60")) or (system = "urn:CodeSystem:health-care-profile" and ((code = "14" and display = "Онкология") or (code = "51" and display = "Онкология детская"))))'::jsquery OR (SELECT  "enc_code"
                    FROM unnest(knife_extract_text (encounter.resource::jsonb,'[["contained",{},"code","coding",{"system":"urn:CodeSystem:icd-10"},"code"]]'::jsonb))  "enc_code"
                    WHERE ( "enc_code" = 'Z03.1' OR (( "enc_code" >= 'C00' AND  "enc_code" < 'C97') OR ( "enc_code" LIKE 'C97%')) OR (( "enc_code" >= 'D00' AND  "enc_code" < 'D09') OR ( "enc_code" LIKE 'D09%')) OR  "enc_code" = 'B18.0' OR  "enc_code" = 'B18.1' OR (( "enc_code" >= 'D10' AND  "enc_code" < 'D11') OR ( "enc_code" LIKE 'D11%')) OR  "enc_code" = 'D12.6' OR  "enc_code" = 'D13.1' OR  "enc_code" = 'D13.4' OR  "enc_code" = 'D13.7' OR  "enc_code" = 'D14.0' OR  "enc_code" = 'D14.1' OR  "enc_code" = 'D14.2' OR  "enc_code" = 'D14.3' OR (( "enc_code" >= 'D16' AND  "enc_code" < 'D16') OR ( "enc_code" LIKE 'D16%')) OR (( "enc_code" >= 'D22' AND  "enc_code" < 'D24') OR ( "enc_code" LIKE 'D24%')) OR  "enc_code" = 'D29.1' OR  "enc_code" = 'D30.0' OR  "enc_code" = 'D30.3' OR  "enc_code" = 'D30.4' OR (( "enc_code" >= 'D31' AND  "enc_code" < 'D31') OR ( "enc_code" LIKE 'D31%')) OR  "enc_code" = 'D35.0' OR  "enc_code" = 'D35.1' OR  "enc_code" = 'D35.2' OR  "enc_code" = 'D35.8' OR  "enc_code" = 'D37.6' OR  "enc_code" = 'D39.1' OR  "enc_code" = 'D41.0' OR  "enc_code" = 'D44.8' OR (( "enc_code" >= 'D81' AND  "enc_code" < 'D84') OR ( "enc_code" LIKE 'D84%')) OR  "enc_code" = 'E05.0' OR  "enc_code" = 'E06.3' OR  "enc_code" = 'E22.0' OR  "enc_code" = 'E28.2' OR  "enc_code" = 'E34.5' OR  "enc_code" = 'E34.8' OR (( "enc_code" >= 'J31' AND  "enc_code" < 'J31') OR ( "enc_code" LIKE 'J31%')) OR (( "enc_code" >= 'J33' AND  "enc_code" < 'J33') OR ( "enc_code" LIKE 'J33%')) OR  "enc_code" = 'J37.0' OR  "enc_code" = 'J37.1' OR  "enc_code" = 'J38.1' OR  "enc_code" = 'K13.0' OR  "enc_code" = 'K13.2' OR  "enc_code" = 'K13.7' OR  "enc_code" = 'K22.0' OR  "enc_code" = 'K22.2' OR  "enc_code" = 'K22.7' OR  "enc_code" = 'K29.4' OR  "enc_code" = 'K29.5' OR  "enc_code" = 'K31.7' OR (( "enc_code" >= 'K50' AND  "enc_code" < 'K50') OR ( "enc_code" LIKE 'K50%')) OR  "enc_code" = 'K51.0' OR  "enc_code" = 'K51.2' OR  "enc_code" = 'K51.3' OR  "enc_code" = 'K51.4' OR  "enc_code" = 'K51.5' OR  "enc_code" = 'K51.8' OR  "enc_code" = 'K51.9' OR  "enc_code" = 'K74.3' OR  "enc_code" = 'K74.4' OR  "enc_code" = 'K74.5' OR  "enc_code" = 'K74.6' OR (( "enc_code" >= 'L57' AND  "enc_code" < 'L57') OR ( "enc_code" LIKE 'L57%')) OR (( "enc_code" >= 'L82' AND  "enc_code" < 'L82') OR ( "enc_code" LIKE 'L82%')) OR (( "enc_code" >= 'M85' AND  "enc_code" < 'M85') OR ( "enc_code" LIKE 'M85%')) OR (( "enc_code" >= 'M88' AND  "enc_code" < 'M88') OR ( "enc_code" LIKE 'M88%')) OR (( "enc_code" >= 'M96' AND  "enc_code" < 'M96') OR ( "enc_code" LIKE 'M96%')) OR  "enc_code" = 'N48.0' OR (( "enc_code" >= 'N60' AND  "enc_code" < 'N60') OR ( "enc_code" LIKE 'N60%')) OR (( "enc_code" >= 'N84' AND  "enc_code" < 'N84') OR ( "enc_code" LIKE 'N84%')) OR  "enc_code" = 'N85.0' OR  "enc_code" = 'N85.1' OR (( "enc_code" >= 'N87' AND  "enc_code" < 'N87') OR ( "enc_code" LIKE 'N87%')) OR  "enc_code" = 'N88.0' OR (( "enc_code" >= 'Q50' AND  "enc_code" < 'Q50') OR ( "enc_code" LIKE 'Q50%')) OR (( "enc_code" >= 'Q56' AND  "enc_code" < 'Q56') OR ( "enc_code" LIKE 'Q56%')) OR  "enc_code" = 'Q78.1' OR  "enc_code" = 'Q82.1' OR  "enc_code" = 'Q82.5' OR  "enc_code" = 'Q85.1' OR (( "enc_code" >= 'Q96' AND  "enc_code" < 'Q99') OR ( "enc_code" LIKE 'Q99%')) OR  "enc_code" = 'B18.0' OR  "enc_code" = 'B18.1' OR (( "enc_code" >= 'D00' AND  "enc_code" < 'D11') OR ( "enc_code" LIKE 'D11%')) OR  "enc_code" = 'D12.6' OR  "enc_code" = 'D13.1' OR  "enc_code" = 'D13.4' OR  "enc_code" = 'D13.7' OR (( "enc_code" >= 'D14' AND  "enc_code" < 'D14') OR ( "enc_code" LIKE 'D14%')) OR (( "enc_code" >= 'D16' AND  "enc_code" < 'D16') OR ( "enc_code" LIKE 'D16%')) OR (( "enc_code" >= 'D22' AND  "enc_code" < 'D24') OR ( "enc_code" LIKE 'D24%')) OR  "enc_code" = 'D29.1' OR  "enc_code" = 'D30.0' OR  "enc_code" = 'D30.3' OR  "enc_code" = 'D30.4' OR (( "enc_code" >= 'D31' AND  "enc_code" < 'D31') OR ( "enc_code" LIKE 'D31%')) OR  "enc_code" = 'D35.0' OR  "enc_code" = 'D35.1' OR  "enc_code" = 'D35.2' OR  "enc_code" = 'D35.8' OR  "enc_code" = 'D37.6' OR  "enc_code" = 'D39.1' OR  "enc_code" = 'D41.0' OR  "enc_code" = 'D44.8' OR (( "enc_code" >= 'D81' AND  "enc_code" < 'D84') OR ( "enc_code" LIKE 'D84%')) OR  "enc_code" = 'E05.0' OR  "enc_code" = 'E06.3' OR  "enc_code" = 'E22.0' OR  "enc_code" = 'E28.2' OR  "enc_code" = 'E34.5' OR  "enc_code" = 'E34.8' OR (( "enc_code" >= 'J31' AND  "enc_code" < 'J31') OR ( "enc_code" LIKE 'J31%')) OR (( "enc_code" >= 'J33' AND  "enc_code" < 'J33') OR ( "enc_code" LIKE 'J33%')) OR  "enc_code" = 'J37.0' OR  "enc_code" = 'J37.1' OR  "enc_code" = 'J38.1' OR  "enc_code" = 'K13.0' OR  "enc_code" = 'K13.2' OR  "enc_code" = 'K13.7' OR  "enc_code" = 'K22.0' OR  "enc_code" = 'K22.2' OR  "enc_code" = 'K22.7' OR  "enc_code" = 'K29.4' OR  "enc_code" = 'K29.5' OR  "enc_code" = 'K31.7' OR (( "enc_code" >= 'K50' AND  "enc_code" < 'K51') OR ( "enc_code" LIKE 'K51%')) OR  "enc_code" = 'K74.3' OR  "enc_code" = 'K74.4' OR  "enc_code" = 'K74.5' OR  "enc_code" = 'K74.6' OR (( "enc_code" >= 'L57' AND  "enc_code" < 'L57') OR ( "enc_code" LIKE 'L57%')) OR (( "enc_code" >= 'L82' AND  "enc_code" < 'L82') OR ( "enc_code" LIKE 'L82%')) OR (( "enc_code" >= 'M85' AND  "enc_code" < 'M85') OR ( "enc_code" LIKE 'M85%')) OR (( "enc_code" >= 'M88' AND  "enc_code" < 'M88') OR ( "enc_code" LIKE 'M88%')) OR (( "enc_code" >= 'M96' AND  "enc_code" < 'M96') OR ( "enc_code" LIKE 'M96%')) OR  "enc_code" = 'N48.0' OR (( "enc_code" >= 'N60' AND  "enc_code" < 'N60') OR ( "enc_code" LIKE 'N60%')) OR (( "enc_code" >= 'N84' AND  "enc_code" < 'N84') OR ( "enc_code" LIKE 'N84%')) OR  "enc_code" = 'N85.0' OR  "enc_code" = 'N85.1' OR (( "enc_code" >= 'N87' AND  "enc_code" < 'N87') OR ( "enc_code" LIKE 'N87%')) OR  "enc_code" = 'N88.0' OR (( "enc_code" >= 'Q50' AND  "enc_code" < 'Q50') OR ( "enc_code" LIKE 'Q50%')) OR (( "enc_code" >= 'Q56' AND  "enc_code" < 'Q56') OR ( "enc_code" LIKE 'Q56%')) OR  "enc_code" = 'Q78.1' OR  "enc_code" = 'Q82.1' OR  "enc_code" = 'Q82.5' OR  "enc_code" = 'Q85.1' OR (( "enc_code" >= 'Q96' AND  "enc_code" < 'Q99') OR ( "enc_code" LIKE 'Q99%')) OR (( "enc_code" >= 'C00' AND  "enc_code" < 'C97') OR ( "enc_code" LIKE 'C97%')))
                    LIMIT 1) IS NOT NULL))
                    ORDER BY cast( "encounter". "resource" #>> '{period,start}' AS  "timestamptz") DESC NULLS first LIMIT 6)  "encounter_subselect") AS  "encounter"
      FROM  "patient"
      WHERE  "patient". "id" = '002c9838-45f4-4eda-b150-c5f93f648e77')  "patient_subselect"
LIMIT 100 OFFSET 0